# å±¥ä¿®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - è¨­è¨ˆæŒ‡é‡ã¨å®Ÿè£…æˆ¦ç•¥

## ğŸ¤ ç§ã®å½¹å‰²ã¨å§¿å‹¢

### æ­£ç›´ã§å»ºè¨­çš„ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼
- æŠ€è¡“çš„ãªåˆ¶ç´„ã‚„å•é¡Œç‚¹ã‚’éš ã•ãšç‡ç›´ã«èª¬æ˜ã—ã¾ã™
- ã€Œå®Œå…¨ã€ã€Œå®Œç’§ã€ã¨ã„ã£ãŸèª‡å¼µè¡¨ç¾ã¯é¿ã‘ã€ç¾å®Ÿçš„ãªè§£æ±ºç­–ã‚’ææ¡ˆã—ã¾ã™
- å®Ÿè£…ã®é™ç•Œã‚’èªè­˜ã—ã€æ®µéšçš„ãªæ”¹å–„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é‡è¦–ã—ã¾ã™

### ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã¨ãƒ†ã‚¹ãƒˆé§†å‹•ã«ã‚ˆã‚‹æ·±ã„æ´å¯Ÿã®ä¿ƒé€²
t_wadaï¼ˆå’Œç”°æ‹“äººï¼‰ã®TDDå“²å­¦ã«åŸºã¥ãã€ãƒ™ã‚¤ãƒ“ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—ã§å¯¾è©±ã‚’é€²ã‚ã€å¯¾è±¡ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã™ã‚‹ç†è§£ã‚’æ·±ã‚ã¾ã™ã€‚
AIã«ã‚ˆã‚‹è‡ªå‹•ã«ã‚ˆã‚‹åŠ¹ç‡æ€§ã‚ˆã‚Šã‚‚ã€AIã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æœ¬è³ªã‚’ç†è§£ã™ã‚‹ã“ã¨ã‚’é‡è¦–ã—ã¾ã™ã€‚

## é–‹ç™ºãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ»è¨€èª

- TypeScript -
  å‹å®‰å…¨æ€§ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒã‚§ãƒƒã‚¯
  - Node.js - ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å®Ÿè¡Œç’°å¢ƒ
  - Zod - å®Ÿè¡Œæ™‚å‹æ¤œè¨¼ã¨ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

- Domain-Driven Design (DDD) -
  ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸­å¿ƒè¨­è¨ˆ
- Hexagonal Architecture -
  ãƒãƒ¼ãƒˆ&ã‚¢ãƒ€ãƒ—ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³
- Event Sourcing -
  ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†
- CQRS - ã‚³ãƒãƒ³ãƒ‰ã‚¯ã‚¨ãƒªè²¬å‹™åˆ†é›¢
- Functional Programming -
  é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ‰‹æ³•

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ORM

  - PostgreSQL -
  ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  - Prisma - TypeScriptå¯¾å¿œORM
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† -
  ACIDç‰¹æ€§ä¿è¨¼

## å‹ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

  - Brand Types - æ„å‘³çš„å‹åŒºåˆ¥
  - Discriminated Union -
  å‹å®‰å…¨ãªçŠ¶æ…‹è¡¨ç¾
  - Eitherå‹ -
  é–¢æ•°å‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - å®Ÿè¡Œæ™‚å‹æ¤œè¨¼ -
  Zodã«ã‚ˆã‚‹å®‰å…¨æ€§ä¿è¨¼

## ãƒ†ã‚¹ãƒˆ

  - Jest/Vitest - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ¡†æ¶
  - Test-Driven Development (TDD) -
  ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º

## ä¸¦è¡Œåˆ¶å¾¡ãƒ»æ•´åˆæ€§

  - æ¥½è¦³çš„ãƒ­ãƒƒã‚¯ -
  ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ã‚ˆã‚‹ç«¶åˆåˆ¶å¾¡
  - ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ -
  è¿½è¨˜å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢
  - è¤‡åˆã‚­ãƒ¼åˆ¶ç´„ -
  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«æ•´åˆæ€§

## è¨­è¨ˆåŸå‰‡

  - Immutability - ä¸å¤‰ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
  - Pure Functions -
  å‰¯ä½œç”¨ã®ãªã„é–¢æ•°
  - ä¾å­˜æ€§é€†è»¢ -
  ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹é§†å‹•è¨­è¨ˆ
  - å˜ä¸€è²¬ä»»åŸå‰‡ - æ˜ç¢ºãªå½¹å‰²åˆ†é›¢

## é‹ç”¨ãƒ»ç›£è¦–

  - ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ -
  ç›£æŸ»è¨¼è·¡ã¨ã‚·ã‚¹ãƒ†ãƒ é–“é€£æº
  - ã‚¨ãƒ©ãƒ¼è¿½è·¡ - æ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼ç®¡ç†
  - ãƒ­ã‚°ç®¡ç† - é‹ç”¨å¯è¦–æ€§

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
src/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ types.ts                 # Zodã«ã‚ˆã‚‹å‹å®šç¾©
â”‚   â”œâ”€â”€ errors.ts                # ã‚¨ãƒ©ãƒ¼å‹å®šç¾©
â”‚   â”œâ”€â”€ domain-events.ts         # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
â”‚   â””â”€â”€ enrollment-aggregate.ts  # é›†ç´„æ“ä½œ
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ ports.ts                 # ä¾å­˜æ€§é€†è»¢ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ dtos.ts                  # DTOs
â”‚   â””â”€â”€ enrollment-service.ts    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma        # DBã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ enrollment-repository.ts  # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
â””â”€â”€ tests/
    â”œâ”€â”€ domain/
    â”œâ”€â”€ application/
    â””â”€â”€ infrastructure/
```

## ğŸ“Š çŠ¶æ…‹é·ç§»å›³

```mermaid
stateDiagram-v2
    [*] --> Requested: requestEnrollment
    Requested --> Approved: approve
    Requested --> Cancelled: cancel
    Approved --> Cancelled: cancel
    Approved --> Completed: complete
    Approved --> Failed: fail
    Cancelled --> [*]
    Completed --> [*]
    Failed --> [*]
```


## ğŸ“ æ ¸å¿ƒçš„ãªè¨­è¨ˆåŸå‰‡

### 1. é–¢æ•°å‹DDDã®å®Ÿè·µ

#### ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ
```typescript
// âŒ é¿ã‘ã‚‹ã¹ãå®Ÿè£…
enrollment.status = 'approved';
enrollment.approvedAt = new Date();

// âœ… æ¨å¥¨ã™ã‚‹å®Ÿè£…
const approvedEnrollment = {
  ...enrollment,
  status: 'approved' as const,
  approvedAt: new Date(),
  version: enrollment.version + 1
};
```

**è¨­è¨ˆæ„å›³**: çŠ¶æ…‹å¤‰æ›´ã‚’æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã¨ã—ã¦è¡¨ç¾ã—ã€äºˆæœŸã—ãªã„å‰¯ä½œç”¨ã‚’é˜²ã

#### Eitherå‹ã«ã‚ˆã‚‹æ˜ç¤ºçš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
type Either<L, R> =
  | { type: 'left'; value: L }   // ã‚¨ãƒ©ãƒ¼
  | { type: 'right'; value: R };  // æˆåŠŸ

// ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ä»£ã‚ã‚Šã«ã€ã‚¨ãƒ©ãƒ¼ã‚’å€¤ã¨ã—ã¦æ‰±ã†
function approveEnrollment(
  enrollment: RequestedEnrollment,
  approvedBy: string
): Either<EnrollmentError, ApprovedEnrollment>
```

**è¨­è¨ˆæ„å›³**: ã‚¨ãƒ©ãƒ¼ã‚’å‹ã‚·ã‚¹ãƒ†ãƒ ã§è¿½è·¡å¯èƒ½ã«ã—ã€å‡¦ç†ã®åˆ†å²ã‚’æ˜ç¤ºçš„ã«

### 2. ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã®æœ¬è³ª

#### çŠ¶æ…‹ã§ã¯ãªãã€å‡ºæ¥äº‹ã‚’è¨˜éŒ²ã™ã‚‹
```typescript
// å¾“æ¥ã®CRUDæ€è€ƒ
UPDATE enrollments SET status = 'approved' WHERE id = 123;

// ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°æ€è€ƒ
INSERT INTO domain_events (type, data) VALUES ('EnrollmentApproved', {...});
```

**ãªãœã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã‹ï¼Ÿ**
- **ç›£æŸ»è¨¼è·¡**: ã™ã¹ã¦ã®å¤‰æ›´å±¥æ­´ãŒè‡ªç„¶ã«æ®‹ã‚‹
- **æ™‚é–“è»¸ã§ã®å†ç¾**: ä»»æ„ã®æ™‚ç‚¹ã®çŠ¶æ…‹ã‚’å¾©å…ƒå¯èƒ½
- **çµ±åˆã®å®¹æ˜“ã•**: ä»–ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ãŒè‡ªç„¶ã«å®Ÿç¾

#### ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰ã®çŠ¶æ…‹å¾©å…ƒ
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰ç¾åœ¨ã®çŠ¶æ…‹ã‚’æ§‹ç¯‰
function reconstructEnrollmentFromEvents(
  events: EnrollmentDomainEvent[]
): Either<EnrollmentError, Enrollment | null> {
  // åˆæœŸçŠ¶æ…‹ã‹ã‚‰é †æ¬¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’é©ç”¨
  let enrollment = createInitialState(events[0]);

  for (const event of events.slice(1)) {
    enrollment = applyEvent(enrollment, event);
  }

  return right(enrollment);
}
```

### 3. å‹å®‰å…¨æ€§ã¸ã®åŸ·ç€

#### Zodã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚æ¤œè¨¼
```typescript
// ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®å‹ãƒã‚§ãƒƒã‚¯ + å®Ÿè¡Œæ™‚ã®æ¤œè¨¼
const EnrollmentSchema = z.discriminatedUnion('status', [
  RequestedEnrollmentSchema,
  ApprovedEnrollmentSchema,
  CancelledEnrollmentSchema,
  CompletedEnrollmentSchema,
  FailedEnrollmentSchema
]);

// å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå–ã‚Šè¾¼ã¿
const result = EnrollmentSchema.safeParse(untrustedData);
if (result.success) {
  // result.data ã¯å®Œå…¨ã«å‹å®‰å…¨
}
```

**è¨­è¨ˆæ„å›³**: TypeScriptã®é™ç•Œã‚’èªè­˜ã—ã€å®Ÿè¡Œæ™‚ã®å®‰å…¨æ€§ã‚‚ä¿è¨¼

#### ãƒ–ãƒ©ãƒ³ãƒ‰å‹ã«ã‚ˆã‚‹æ„å‘³çš„ãªåŒºåˆ¥
```typescript
// å˜ãªã‚‹stringã§ã¯ãªãã€æ„å‘³ã‚’æŒã¤å‹ã¨ã—ã¦å®šç¾©
export const StudentIdSchema = z.string()
  .regex(/^[A-Z0-9]{1,20}$/)
  .brand<'StudentId'>();

// ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«é–“é•ã„ã‚’é˜²ã’ã‚‹
function enrollStudent(
  studentId: StudentId,  // CourseIdã‚’æ¸¡ã™ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼
  courseId: CourseId
)
```

### 4. ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

#### ãƒãƒ¼ãƒˆã¨ã‚¢ãƒ€ãƒ—ã‚¿
```typescript
// ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã¿ã«ä¾å­˜
interface IEnrollmentRepository {
  findByStudentAndCourse(
    studentId: StudentId,
    courseId: CourseId
  ): Promise<Either<EnrollmentError, Enrollment | null>>;
}

// å®Ÿè£…è©³ç´°ã¯å¤–å´ã®å±¤ã§
class PrismaEnrollmentRepository implements IEnrollmentRepository {
  // Prismaç‰¹æœ‰ã®å®Ÿè£…
}
```

**è¨­è¨ˆæ„å›³**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‹ã‚‰ç‹¬ç«‹ã•ã›ã‚‹

## ğŸ¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®æ´å¯Ÿ

### å±¥ä¿®ã«ãŠã‘ã‚‹æœ¬è³ªçš„ãªåˆ¶ç´„

1. **æ™‚é–“çš„ãªä¸€æ–¹å‘æ€§**
   - ä¸€åº¦æ‰¿èªã•ã‚ŒãŸå±¥ä¿®ã¯ã€Œæœªç”³è«‹ã€ã«æˆ»ã›ãªã„
   - ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯æ–°ãŸãªçŠ¶æ…‹ã¸ã®é·ç§»ã§ã‚ã‚Šã€å‰Šé™¤ã§ã¯ãªã„

2. **ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ã®è¦æ±‚**
   - èª°ãŒã€ã„ã¤ã€ãªãœãã®æ±ºå®šã‚’ã—ãŸã®ã‹
   - æ•™è‚²æ©Ÿé–¢ã«ãŠã‘ã‚‹èª¬æ˜è²¬ä»»

3. **ä¸¦è¡Œæ€§ã®èª²é¡Œ**
   - åŒã˜å±¥ä¿®æ ã‚’è¤‡æ•°ã®å­¦ç”ŸãŒåŒæ™‚ã«ç”³è«‹
   - æ¥½è¦³çš„ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹è§£æ±º

### çŠ¶æ…‹é·ç§»ã®æ„å‘³è«–

```mermaid
stateDiagram-v2
    [*] --> Requested: å­¦ç”Ÿã®æ„æ€è¡¨ç¤º
    Requested --> Approved: æ•™å‹™ã®æ‰¿èª
    Requested --> Cancelled: å­¦ç”Ÿã®æ’¤å›
    Approved --> Cancelled: ç‰¹åˆ¥ãªäº‹æƒ…
    Approved --> Completed: å˜ä½ä¿®å¾—
    Approved --> Failed: å˜ä½æœªä¿®å¾—
```

å„é·ç§»ãŒæŒã¤ãƒ“ã‚¸ãƒã‚¹ä¸Šã®æ„å‘³ï¼š
- **Requested**: å­¦ç”Ÿã®å­¦ç¿’æ„æ¬²ã®è¡¨æ˜
- **Approved**: æ©Ÿé–¢ã«ã‚ˆã‚‹å­¦ç¿’æ©Ÿä¼šã®ä¿è¨¼
- **Completed/Failed**: å­¦ç¿’æˆæœã®è¨˜éŒ²

## ğŸ”„ æ®µéšçš„ãªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### Phase 1: åŸºç¤çš„ãªçŠ¶æ…‹ç®¡ç†
```typescript
// ã¾ãšæœ€ã‚‚å˜ç´”ãªã€Œç”³è«‹ã€ã‹ã‚‰å§‹ã‚ã‚‹
test('å±¥ä¿®ã‚’ç”³è«‹ã§ãã‚‹', () => {
  const result = requestEnrollment('ST001', 'CS101', '2025-spring');
  expect(result.type).toBe('right');
  expect(result.value.status).toBe('requested');
});
```

### Phase 2: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ 
```typescript
// å‰ææ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
test('å‰æç§‘ç›®ã‚’æº€ãŸã•ãªã„å ´åˆã¯ç”³è«‹ã§ããªã„', async () => {
  const result = await service.requestEnrollment({
    studentId: 'ST001',
    courseId: 'CS201',  // CS101ãŒå‰æ
    semester: '2025-spring'
  });

  expect(result.type).toBe('left');
  expect(result.value.rule).toBe('PREREQUISITES_NOT_MET');
});
```

### Phase 3: éåŒæœŸå‡¦ç†ã¨çµ±åˆ
```typescript
// å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
test('æ‰¿èªæ™‚ã«å­¦ç”Ÿã«é€šçŸ¥ãŒé€ã‚‰ã‚Œã‚‹', async () => {
  const notificationSpy = jest.spyOn(notificationService, 'notify');

  await service.approveEnrollment(command);

  expect(notificationSpy).toHaveBeenCalledWith(
    expect.objectContaining({
      type: 'ENROLLMENT_APPROVED',
      studentId: 'ST001'
    })
  );
});
```

## ğŸš¦ ç¾å®Ÿçš„ãªåˆ¶ç´„ã¨å¯¾å‡¦æ³•

### èªè­˜ã™ã¹ãé™ç•Œ

1. **ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆã‚¢ã®æˆé•·**
   - æ™‚é–“ã¨ã¨ã‚‚ã«è‚¥å¤§åŒ–ã™ã‚‹
   - â†’ ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæˆ¦ç•¥ã®å¿…è¦æ€§

2. **åˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**
   - è¤‡æ•°ã®ã‚·ã‚¹ãƒ†ãƒ é–“ã§ã®æ•´åˆæ€§
   - â†’ Sagaãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥æ¤œè¨

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**
   - ã‚¤ãƒ™ãƒ³ãƒˆå†ç”Ÿã®ã‚³ã‚¹ãƒˆ
   - â†’ CQRSï¼ˆèª­ã¿å–ã‚Šãƒ¢ãƒ‡ãƒ«ã®åˆ†é›¢ï¼‰

### æ®µéšçš„ãªæ”¹å–„æˆ¦ç•¥

```typescript
// Step 1: åŸºæœ¬çš„ãªã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°
class BasicEventStore {
  async save(event: DomainEvent): Promise<void> {
    await this.db.events.create({ data: event });
  }
}

// Step 2: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½ã®è¿½åŠ 
class OptimizedEventStore extends BasicEventStore {
  async saveWithSnapshot(
    event: DomainEvent,
    aggregate: Aggregate
  ): Promise<void> {
    if (event.version % 10 === 0) {
      await this.saveSnapshot(aggregate);
    }
    await super.save(event);
  }
}

// Step 3: èª­ã¿å–ã‚Šãƒ¢ãƒ‡ãƒ«ã®å°å…¥
class CQRSEventStore extends OptimizedEventStore {
  async save(event: DomainEvent): Promise<void> {
    await super.save(event);
    await this.updateReadModel(event);
  }
}
```

## ğŸ’¡ AIã¨ã®å¯¾è©±ã«ã‚ˆã‚‹ç†è§£ã®æ·±åŒ–

### åŠ¹æœçš„ãªè³ªå•ä¾‹

1. **ä»•æ§˜ã®æ˜ç¢ºåŒ–**
   - ã€Œå­¦ç”ŸãŒé€€å­¦ã—ãŸå ´åˆã€æ‰¿èªæ¸ˆã¿ã®å±¥ä¿®ã¯ã©ã†ãªã‚‹ã¹ãï¼Ÿã€
   - ã€ŒåŒæ™‚ã«å±¥ä¿®ã§ãã‚‹ç§‘ç›®æ•°ã«ä¸Šé™ã¯ã‚ã‚‹ï¼Ÿã€

2. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ç™ºè¦‹**
   - ã€Œç· åˆ‡ç›´å‰ã«å®šå“¡ã«é”ã—ãŸå ´åˆã®å‡¦ç†ã¯ï¼Ÿã€
   - ã€Œã‚·ã‚¹ãƒ†ãƒ éšœå®³ã§æ‰¿èªé€šçŸ¥ã ã‘å¤±æ•—ã—ãŸã‚‰ï¼Ÿã€

3. **è¨­è¨ˆã®æ”¹å–„**
   - ã€Œã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯æœ¬å½“ã«å¿…è¦ï¼Ÿä½•ã‚’è¡¨ç¾ã—ã¦ã„ã‚‹ï¼Ÿã€
   - ã€Œã“ã®çŠ¶æ…‹é·ç§»ã«é•å’Œæ„ŸãŒã‚ã‚‹ã€‚ä»–ã®æ–¹æ³•ã¯ï¼Ÿã€

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚¯ãƒ«

```typescript
// Red: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
test('ç‰¹åˆ¥ãªäº‹æƒ…ã«ã‚ˆã‚Šæ‰¿èªæ¸ˆã¿å±¥ä¿®ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ãã‚‹', () => {
  const approved = createApprovedEnrollment(...);
  const result = cancelApprovedEnrollment(approved, 'ç—…æ°—ç™‚é¤Š');
  expect(result.type).toBe('right');
});

// Green: æœ€å°é™ã®å®Ÿè£…
function cancelApprovedEnrollment(enrollment, reason) {
  return right({
    ...enrollment,
    status: 'cancelled',
    cancelReason: reason
  });
}

// Refactor: ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆã¸
function cancelApprovedEnrollment(
  enrollment: ApprovedEnrollment,
  reason: string
): Either<EnrollmentError, CancelledEnrollment> {
  // ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®ç”Ÿæˆã‚‚å«ã‚ãŸå®Œå…¨ãªå®Ÿè£…ã¸
}
```

## ğŸ“š æ¨å¥¨ã™ã‚‹å­¦ç¿’ãƒ‘ã‚¹

1. **åŸºç¤ç†è§£**
   - å˜ç´”ãªçŠ¶æ…‹é·ç§»ã®å®Ÿè£…
   - Eitherãƒ¢ãƒŠãƒ‰ã®ä½¿ã„æ–¹
   - ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªæ›´æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³

2. **ãƒ‰ãƒ¡ã‚¤ãƒ³ç†è§£ã®æ·±åŒ–**
   - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®ç™ºè¦‹ã¨å®Ÿè£…
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ´—ã„å‡ºã—
   - ã‚¤ãƒ™ãƒ³ãƒˆã®æ„å‘³ã®è€ƒå¯Ÿ

3. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ´—ç·´**
   - ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é©ç”¨
   - ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã®æœ€é©åŒ–
   - CQRSã®å°å…¥

4. **é‹ç”¨ã¸ã®é…æ…®**
   - ç›£è¦–ã¨ãƒ­ã‚®ãƒ³ã‚°
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
   - æ®µéšçš„ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸ¯ ã¾ã¨ã‚

ã“ã®è¨­è¨ˆã¯ã€Œå®Œç’§ã€ã‚’ç›®æŒ‡ã™ã®ã§ã¯ãªãã€ä»¥ä¸‹ã‚’é‡è¦–ã—ã¾ã™ï¼š

- **ç†è§£å¯èƒ½æ€§**: ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒç†è§£ã—ã€æ‹¡å¼µã§ãã‚‹
- **ä¿å®ˆæ€§**: å°†æ¥ã®å¤‰æ›´ã«å¯¾å¿œã—ã‚„ã™ã„
- **æ®µéšçš„æ”¹å–„**: ä¸€åº¦ã«ã™ã¹ã¦ã‚’å®Ÿè£…ã—ãªã„
- **ç¾å®Ÿçš„**: ç†æƒ³ã¨ç¾å®Ÿã®ãƒãƒ©ãƒ³ã‚¹

ç§ã¯ã€ã‚ãªãŸã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç†è§£ã‚’æ·±ã‚ã‚‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦ã€å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§ç€å®Ÿã«å‰é€²ã™ã‚‹ã“ã¨ã‚’æ”¯æ´ã—ã¾ã™ã€‚